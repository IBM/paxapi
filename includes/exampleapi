<h1 id='examples-of-processing'>Examples of processing</h1><h2 id='processing-outside-of-vba'>Processing outside of VBA</h2>
<blockquote>
<p>The following Visual Basic Script opens Microsoft Office Excel, logs on to IBM Cognos Analytics, refreshes the content, and logs off.</p>
</blockquote>
<div class="highlight"><pre class="highlight vb tab-vb"><code><span class="c1">' Start Excel in batch mode</span>

<span class="k">Set</span> <span class="n">objExcel</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Excel.Application"</span><span class="p">)</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="k">False</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">False</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">DisplayAlerts</span> <span class="o">=</span> <span class="k">False</span>

<span class="c1">'Open a workbook that has IBM Cognos data</span>
<span class="n">in</span> <span class="n">it</span><span class="p">.</span>

<span class="n">Set</span> <span class="n">objWorkbook</span> <span class="o">=</span> <span class="n">objExcel</span><span class="p">.</span><span class="n">Workbooks</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="s">"C:\workbook1.xls"</span><span class="p">)</span>

<span class="c1">' Call the wrapper macros</span>

<span class="n">bResult</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logon</span>
<span class="p">(</span><span class="s">"http://localhost/ibmcognos/cgi-bin/cognos.cgi"</span><span class="p">,</span>
<span class="s">"Administrator"</span><span class="p">,</span> <span class="s">"CognosAdmin"</span><span class="p">,</span> <span class="s">"Production"</span><span class="p">)</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"RefreshAllData"</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"Logoff"</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"TraceLog"</span><span class="p">,</span> <span class="s">"C:\AutomationLog.log"</span>

<span class="n">objWorkbook</span><span class="p">.</span><span class="n">Save</span>

<span class="n">objWorkbook</span><span class="p">.</span><span class="n">Close</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Quit</span>
</code></pre></div>
<p>If you want to use IBM® Cognos® Office Automation outside VBA, you cannot call the APIs directly. This topic describes how you can call the APIs outside of VBA.</p>

<p>To use IBM Cognos Office Automation outside VBA, you must create wrapper macros in the Microsoft Office document for each API. You can then call these macros from your code. The module CognosOfficeAutomationExample.bas is an example of a wrapper macro that you can call from outside VBA.</p>

<p>Although Planning Analytics for Microsoft Excel supports processing outside of VBA, it is not recommended due to certain environmental constraints. If you need to process outside of VBA, you should start with using the sample files. Processing outside of VBA will require you to make self-service changes and have the system knowledge required to allow for complex usage scenarios.</p>
<h2 id='processing-within-vba'>Processing within VBA</h2>
<blockquote>
<p>The following example demonstrates how to call the Logon method within VBA</p>
</blockquote>
<div class="highlight"><pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">bResult</span> <span class="n">as</span> <span class="kt">Boolean</span>

<span class="n">bResult</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logon</span>
<span class="p">(</span><span class="s">"http://localhost/ibmcognos/cgi-bin/cognos.cgi"</span><span class="p">,</span><span class="s">"Administrator"</span><span class="p">,</span>
<span class="s">"CognosAdmin"</span><span class="p">,</span> <span class="s">"Production"</span><span class="p">)</span>

<span class="k">If</span> <span class="n">bResult</span> <span class="k">Then</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">ClearAllData</span><span class="p">()</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">RefreshAllData</span><span class="p">()</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logoff</span><span class="p">()</span>

    <span class="k">Dim</span> <span class="nv">sTraceLog</span> <span class="n">as</span> <span class="kt">String</span> 

    <span class="n">sTraceLog</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">TraceLog</span>

    <span class="c1">'Here is where you could write the trace log to file.</span>

    <span class="n">MsgBox</span> <span class="n">sTraceLog</span>

<span class="k">End</span> <span class="k">If</span>
</code></pre></div><h2 id='troubleshooting-issues'>Troubleshooting issues</h2>
<p>You may encounter issues when processing outside of VBA. This section outlines a few commong issues.</p>
<h3 id='the-script-runs-but-nothing-happens'>The script runs, but nothing happens</h3>
<blockquote>
<p>Example</p>
</blockquote>
<div class="highlight"><pre class="highlight vb tab-vb"><code><span class="c1">' This example is placed in the CognosOfficeAutomationExample.bas file</span>

<span class="k">Public</span> <span class="k">Sub</span> <span class="nf">ClearAllData</span><span class="p">()</span>
<span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">HANDLER</span><span class="p">:</span>
<span class="k">Dim</span> <span class="nv">oMessageSuppressor</span> <span class="ow">As</span> <span class="n">CognosOfficeMessageSuppressor</span>

    <span class="c1">'Use the message suppressor to turn off all Cognos Office messages.</span>
    <span class="k">Set</span> <span class="n">oMessageSuppressor</span> <span class="o">=</span> <span class="k">New</span> <span class="n">CognosOfficeMessageSuppressor</span>

    <span class="k">Dim</span> <span class="nv">test</span> <span class="ow">As</span> <span class="kt">Object</span>
    <span class="k">Set</span> <span class="n">test</span> <span class="o">=</span> <span class="n">Reporting</span>

    <span class="c1">'Call the Cognos Office Automation object to clear the data.</span>
    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">ClearAllData</span>

    <span class="k">Exit</span> <span class="k">Sub</span>
<span class="nf">HANDLER</span><span class="p">:</span>
    <span class="c1">'&lt;Place error handling here. You may not want to display a message box if you are running in a scheduled task&gt;</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre></div>
<p>If your script runs, but nothing happens, it may be a sign that the Planning Analytics for Microsoft Excel add-in is not activated. If the add-in is not activated, Microsoft Excel will not know when and where to execute the Planning Analytics for Microsoft Excel APIs.</p>

<p>You can activate the Planning Analytics for Microsoft Excel manually by opening the IBM Planning Analytics tab:</p>

<ol>
<li>Launch Microsoft Excel.</li>
<li>Click the IBM Planning Analytics tab.</li>
</ol>

<p>You can also activate the Planning Analytics for Microsoft Excel by adding the following lines before a macro call:</p>

<p><code>Dim test As Object</code></p>

<p><code>Set test = Reporting</code></p>
<h3 id='application-crashes-on-when-script-is-running'>Application crashes on when script is running</h3>
<blockquote>
<p>Example</p>
</blockquote>
<div class="highlight"><pre class="highlight vb tab-vb"><code><span class="c1">' This example is placed in the Automate_COI.vbs file</span>

<span class="k">Dim</span> <span class="nv">bSuccess</span>
<span class="k">Dim</span> <span class="nv">objExcel</span>
<span class="k">Dim</span> <span class="nv">objWB</span>

<span class="k">Set</span> <span class="n">objExcel</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Excel.Application"</span><span class="p">)</span>

    <span class="k">If</span> <span class="n">objExcel</span> <span class="ow">Is</span> <span class="k">Nothing</span> <span class="k">Then</span> <span class="n">WScript</span><span class="p">.</span><span class="n">Quit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="err">`</span><span class="n">Turn</span> <span class="n">off</span> <span class="n">Excel</span> <span class="n">features</span><span class="p">.</span>
<span class="n">objExcel</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="k">False</span>
<span class="n">objExcel</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">False</span>
<span class="n">objExcel</span><span class="p">.</span><span class="n">DisplayAlerts</span> <span class="o">=</span> <span class="k">False</span>

</code></pre></div>
<p>If the application crashes when you run your script, you may need to check the Microsoft Excel events before you call the Planning Analytics for Microsoft Excel APIs. </p>

<p>To check the Microsoft Excel events, add the following lines to your VBS or VBA file:</p>

<p><code>objExcel.Visible = False</code></p>

<p><code>objExcel.ScreenUpdating = False</code></p>

<p><code>objExcel.DisplayAlerts = False</code></p>

<p>You may also need to add a sleep event before calling the Planning Analytics for Microsoft Excel API. </p>

<p>Example of a sleep event: </p>

<p><code>WScript 5000</code></p>
