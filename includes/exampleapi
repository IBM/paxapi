<h1 id='examples-of-processing'>Examples of processing</h1><h2 id='processing-outside-vba'>Processing outside VBA</h2>
<blockquote>
<p>The following Visual Basic Script opens Microsoft Office Excel, logs on to IBM Cognos Analytics, refreshes the content, and logs off.</p>
</blockquote>
<pre class="highlight vb tab-vb"><code><span class="c1">' Start Excel in batch mode</span>

<span class="k">Set</span> <span class="n">objExcel</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Excel.Application"</span><span class="p">)</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Visible</span> <span class="o">=</span> <span class="k">False</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">ScreenUpdating</span> <span class="o">=</span> <span class="k">False</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">DisplayAlerts</span> <span class="o">=</span> <span class="k">False</span>

<span class="c1">'Open a workbook that has IBM Cognos data</span>
<span class="n">in</span> <span class="n">it</span><span class="p">.</span>

<span class="n">Set</span> <span class="n">objWorkbook</span> <span class="o">=</span> <span class="n">objExcel</span><span class="p">.</span><span class="n">Workbooks</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="s">"C:\workbook1.xls"</span><span class="p">)</span>

<span class="c1">' Call the wrapper macros</span>

<span class="n">bResult</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logon</span>
<span class="p">(</span><span class="s">"http://localhost/ibmcognos/cgi-bin/cognos.cgi"</span><span class="p">,</span>
<span class="s">"Administrator"</span><span class="p">,</span> <span class="s">"CognosAdmin"</span><span class="p">,</span> <span class="s">"Production"</span><span class="p">)</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"RefreshAllData"</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"Logoff"</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Run</span> <span class="s">"TraceLog"</span><span class="p">,</span> <span class="s">"C:\AutomationLog.log"</span>

<span class="n">objWorkbook</span><span class="p">.</span><span class="n">Save</span>

<span class="n">objWorkbook</span><span class="p">.</span><span class="n">Close</span>

<span class="n">objExcel</span><span class="p">.</span><span class="n">Quit</span>
</code></pre>
<p>If you want to use IBM® Cognos® Office Automation outside VBA, you cannot call the APIs directly. This topic describes how you can call the APIs outside of VBA.</p>

<p>To use IBM Cognos Office Automation outside VBA, you must create wrapper macros in the Microsoft Office document for each API. You can then call these macros from your code. The module CognosOfficeAutomationExample.bas is an example of a wrapper macro that you can call from outside VBA.</p>

<p>Although we support processing outside VBA, it&#39;s not the recommended exercise due to environmental constraints. The sample files are a good start, you are expected to make self service changes and have required system  knowledge to allow for complex usage scenarios.</p>
<h2 id='common-troubleshooting-steps-for-outside-in-automation'>Common TroubleShooting Steps for Outside In Automation</h2><h3 id='script-runs-but-nothing-happens'>Script runs but nothing happens</h3>
<blockquote>
<p>Example (Source - CognosOfficeAutomationExample.bas)</p>
</blockquote>

<p>` Clears all the data in the workbook that is mapped to a Cognos Office Data Source. Both Explorations and Formula (UDF) based data will be cleared. This behaves the same as the Clear All Data toolbar button/ribbon button.</p>
<pre class="highlight vb tab-vb"><code><span class="k">Public</span> <span class="k">Sub</span> <span class="nf">ClearAllData</span><span class="p">()</span>
<span class="k">On</span> <span class="k">Error</span> <span class="k">GoTo</span> <span class="n">HANDLER</span><span class="p">:</span>
<span class="k">Dim</span> <span class="nv">oMessageSuppressor</span> <span class="ow">As</span> <span class="n">CognosOfficeMessageSuppressor</span>

<span class="c1">'Use the message suppressor to turn off all Cognos Office messages.</span>
<span class="k">Set</span> <span class="n">oMessageSuppressor</span> <span class="o">=</span> <span class="k">New</span> <span class="n">CognosOfficeMessageSuppressor</span>

<span class="c1">'Call the Cognos Office Automation object to clear the data.</span>
<span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">ClearAllData</span>

<span class="k">Dim</span> <span class="nv">test</span> <span class="ow">As</span> <span class="kt">Object</span>
<span class="k">Set</span> <span class="n">test</span> <span class="o">=</span> <span class="n">Reporting</span>

<span class="k">Exit</span> <span class="k">Sub</span>
<span class="nf">HANDLER</span><span class="p">:</span>
<span class="c1">'&lt;Place error handling here.  Remember you may not want to display a message box if you are running in a scheduled task&gt;</span>
<span class="k">End</span> <span class="k">Sub</span>
</code></pre>
<p>This usually means our add-in isn&#39;t activated and excel doesn&#39;t know when and where to fire our apis. </p>

<p>You could manually open a workbook and click on PA for Excel icon for add in activation.</p>

<p>You could also add this following lines before you desired Macro call.</p>

<p>Dim test As Object
Set test = Reporting</p>
<h3 id='application-crashes-on-script-running'>Application crashes on script running</h3>
<p>Check Excel events before you call our api&#39;s. This is also a Microsoft recommendation.</p>

<p>Turn off Excel features.
<code>objExcel.Visible = False</code></p>

<p><code>objExcel.ScreenUpdating = False</code></p>

<p><code>objExcel.DisplayAlerts = False</code></p>

<p>Add sleep events before calling our api&#39;s.
Eg : <code>WScript 5000</code></p>
<h2 id='processing-within-vba'>Processing within VBA</h2>
<blockquote>
<p>The following example demonstrates how to call the Logon method within VBA</p>
</blockquote>
<pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">bResult</span> <span class="n">as</span> <span class="kt">Boolean</span>

<span class="n">bResult</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logon</span>
<span class="p">(</span><span class="s">"http://localhost/ibmcognos/cgi-bin/cognos.cgi"</span><span class="p">,</span><span class="s">"Administrator"</span><span class="p">,</span>
<span class="s">"CognosAdmin"</span><span class="p">,</span> <span class="s">"Production"</span><span class="p">)</span>

<span class="k">If</span> <span class="n">bResult</span> <span class="k">Then</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">ClearAllData</span><span class="p">()</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">RefreshAllData</span><span class="p">()</span>

    <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">Logoff</span><span class="p">()</span>

    <span class="k">Dim</span> <span class="nv">sTraceLog</span> <span class="n">as</span> <span class="kt">String</span> 

    <span class="n">sTraceLog</span> <span class="o">=</span> <span class="n">CognosOfficeAutomationObject</span><span class="p">.</span><span class="n">TraceLog</span>

    <span class="c1">'Here is where you could write the trace log to file.</span>

    <span class="n">MsgBox</span> <span class="n">sTraceLog</span>

<span class="k">End</span> <span class="k">If</span>
</code></pre>